var CETEI=function(){"use strict";var e={namespaces:{tei:"http://www.tei-c.org/ns/1.0",teieg:"http://www.tei-c.org/ns/Examples",rng:"http://relaxng.org/ns/structure/1.0"},tei:{eg:["<pre>","</pre>"],ptr:['<a href="$rw@target">$@target</a>'],ref:[["[target]",['<a href="$rw@target">',"</a>"]]],graphic:function(e){let t=new Image;return t.src=this.rw(e.getAttribute("url")),e.hasAttribute("width")&&t.setAttribute("width",e.getAttribute("width")),e.hasAttribute("height")&&t.setAttribute("height",e.getAttribute("height")),t},list:[["[type=gloss]",function(e){let t=document.createElement("dl");for(let i of Array.from(e.children))if(i.nodeType==Node.ELEMENT_NODE){if("tei-label"==i.localName){let e=document.createElement("dt");e.innerHTML=i.innerHTML,t.appendChild(e)}if("tei-item"==i.localName){let e=document.createElement("dd");e.innerHTML=i.innerHTML,t.appendChild(e)}}return t}]],note:[["[place=end]",function(e){this.noteIndex?this.noteIndex++:this.noteIndex=1;let t="_note_"+this.noteIndex,i=document.createElement("a");i.setAttribute("id","src"+t),i.setAttribute("href","#"+t),i.innerHTML=this.noteIndex;let s=document.createElement("sup");s.appendChild(i);let n=this.dom.querySelector("ol.notes");n||((n=document.createElement("ol")).setAttribute("class","notes"),this.dom.appendChild(n));let a=document.createElement("li");return a.id=t,a.innerHTML=e.innerHTML,n.appendChild(a),s}],["_",["(",")"]]],teiHeader:function(e){this.hideContent(e,!1)},title:[["tei-titlestmt>tei-title",function(e){let t=document.createElement("title");t.innerHTML=e.innerText,document.querySelector("head").appendChild(t)}]],cell:[["[cols]",function(e){e.setAttribute("style","grid-column: "+this.getOrdinality(e)+" / span "+e.getAttribute("cols")+";")}]]},teieg:{egXML:function(e){let t=document.createElement("pre"),i=this.serialize(e,!0).replace(/</g,"&lt;"),s=i.match(/^[\t ]+/);return s&&(i=i.replace(new RegExp("^"+s[0],"mg"),"")),t.innerHTML=i,t}}};function t(e,t=!0){if(e.childNodes.length>0){let i=document.createElement("span");e.appendChild(i),i.setAttribute("hidden",""),i.setAttribute("data-original","");for(let t of Array.from(e.childNodes))t!==i&&i.appendChild(e.removeChild(t));if(t)for(let e of Array.from(i.querySelectorAll("*")))e.hasAttribute("id")&&(e.setAttribute("data-origid",e.getAttribute("id")),e.removeAttribute("id"))}}var i=Object.freeze({getOrdinality:function(e,t){let i=1,s=e;for(;s&&null!==s.previousElementSibling&&(!t||s.previousElementSibling.localName==t)&&(i++,(s=s.previousElementSibling).previousElementSibling););return i},copyAndReset:function(e){let t=e=>{let i=e.nodeType===Node.ELEMENT_NODE?document.createElement(e.nodeName):e.cloneNode(!0);if(e.attributes)for(let t of Array.from(e.attributes))"data-processed"!==t.name&&i.setAttribute(t.name,t.value);for(let s of Array.from(e.childNodes))if(s.nodeType==Node.ELEMENT_NODE){if(!e.hasAttribute("data-empty")){if(s.hasAttribute("data-original")){for(let e of Array.from(s.childNodes)){let s=i.appendChild(t(e));s.nodeType===Node.ELEMENT_NODE&&s.hasAttribute("data-origid")&&(s.setAttribute("id",s.getAttribute("data-origid")),s.removeAttribute("data-origid"))}return i}i.appendChild(t(s))}}else i.appendChild(s.cloneNode());return i};return t(e)},first:function(e){return e.replace(/ .*$/,"")},hideContent:t,normalizeURI:function(e){return this.rw(this.first(e))},repeat:function(e,t){let i="";for(let s=0;s<t;s++)i+=e;return i},resolveURI:function(e){let t=this.prefixDefs[e.substring(0,e.indexOf(":"))];return e.replace(new RegExp(t.matchPattern),t.replacementPattern)},getPrefixDef:function(e){return this.prefixDefs[e]},rw:function(e){return e.match(/^(?:http|mailto|file|\/|#).*$/)?e:this.base+this.utilities.first(e)},serialize:function(e,t,i){let s="",n=e=>!/[^\t\n\r ]/.test(e);if(!t&&e.nodeType==Node.ELEMENT_NODE){s+="string"==typeof i&&""!==i?"\n"+i+"<":"<",s+=e.getAttribute("data-origname");let t=e.hasAttribute("data-origatts")?e.getAttribute("data-origatts").split(" "):[];for(let i of Array.from(e.attributes))i.name.startsWith("data-")||["id","lang","class"].includes(i.name)||(s+=" "+t.find(function(e){return e.toLowerCase()==i.name})+'="'+i.value+'"'),"data-xmlns"==i.name&&(s+=' xmlns="'+i.value+'"');e.childNodes.length>0?s+=">":s+="/>"}for(let a of Array.from(e.childNodes))switch(a.nodeType){case Node.ELEMENT_NODE:s+="string"==typeof i?this.serialize(a,!1,i+"  "):this.serialize(a,!1,i);break;case Node.PROCESSING_INSTRUCTION_NODE:s+="<?"+a.nodeValue+"?>";break;case Node.COMMENT_NODE:s+="\x3c!--"+a.nodeValue+"--\x3e";break;default:if(t&&n(a.nodeValue)&&(s+=a.nodeValue.replace(/^\s*\n/,"")),"string"==typeof i&&n(a.nodeValue))break;s+=a.nodeValue}return!t&&e.childNodes.length>0&&(s+="string"==typeof i?"\n"+i+"</":"</",s+=e.getAttribute("data-origname")+">"),s},unEscapeEntities:function(e){return e.replace(/&gt;/,">").replace(/&quot;/,'"').replace(/&apos;/,"'").replace(/&amp;/,"&")}});class s{constructor(t){this.options=t||{},this.addBehaviors=function(e){if(e.namespaces)for(let t of Object.keys(e.namespaces))this.namespaces.has(e.namespaces[t])||Array.from(this.namespaces.values()).includes(t)||this.namespaces.set(e.namespaces[t],t);for(let t of this.namespaces.values())if(e[t])for(let i of Object.keys(e[t]))this.behaviors[`${t}:${i}`]=e[t][i];e.handlers&&console.log("Behavior handlers are no longer used."),e.fallbacks&&console.log("Fallback behaviors are no longer used.")}.bind(this),this.addBehavior=function(e,t,i){let s;if(e===Object(e))for(let t of Object.keys(e))this.namespaces.has(e[t])||(this.namespaces.set(e[t],t),s=t);else s=e;this.behaviors[`${s}:${t}`]=i}.bind(this),this.applyBehaviors=function(){window.customElements?this.define.call(this,this.els):this.fallback.call(this,this.els)}.bind(this),this.removeBehavior=function(e,t){let i;if(e===Object(e))for(let t of Object.keys(e))this.namespaces.has(e[t])||(this.namespaces.set(e[t],t),i=t);else i=e;delete this.behaviors[`${i}:${t}`]}.bind(this),this.utilities={};for(const e of Object.keys(i))["getPrefixDef","rw","resolveURI"].includes(e)?this.utilities[e]=i[e].bind(this):this.utilities[e]=i[e];if(this.els=[],this.namespaces=new Map,this.behaviors={},this.hasStyle=!1,this.prefixDefs=[],this.debug=!0===this.options.debug,this.options.base)this.base=this.options.base;else try{window&&(this.base=window.location.href.replace(/\/[^\/]*$/,"/"))}catch(e){this.base=""}this.options.omitDefaultBehaviors||this.addBehaviors(e),this.options.ignoreFragmentId&&window&&window.removeEventListener("ceteiceanload",s.restorePosition)}getHTML5(e,t,i){return window&&window.location.href.startsWith(this.base)&&e.indexOf("/")>=0&&(this.base=e.replace(/\/[^\/]*$/,"/")),new Promise(function(t,i){let s=new XMLHttpRequest;s.open("GET",e),s.send(),s.onload=function(){this.status>=200&&this.status<300?t(this.response):i(this.statusText)},s.onerror=function(){i(this.statusText)}}).catch(function(e){console.log("Could not get XML file."),this.debug&&console.log(e)}).then(e=>this.makeHTML5(e,t,i))}makeHTML5(e,t,i){let s=(new DOMParser).parseFromString(e,"text/xml");return this.domToHTML5(s,t,i)}domToHTML5(e,t,i){this.els=function(e,t){const i=e.documentElement;let s=1,n=function(e){return t.has(e.namespaceURI?e.namespaceURI:"")||t.set(e.namespaceURI,"ns"+s++),t.get(e.namespaceURI?e.namespaceURI:"")+":"+e.localName};const a=new Set(Array.from(i.querySelectorAll("*"),n));return a.add(n(i)),a}(e,this.namespaces);let s=t=>{let n;if(this.namespaces.has(t.namespaceURI?t.namespaceURI:"")){let e=this.namespaces.get(t.namespaceURI?t.namespaceURI:"");n=document.createElement(`${e}-${t.localName}`)}else n=document.importNode(t,!1);for(let e of Array.from(t.attributes))"xmlns"==e.name?n.setAttribute("data-xmlns",e.value):n.setAttribute(e.name,e.value),"xml:id"==e.name&&n.setAttribute("id",e.value),"xml:lang"==e.name&&n.setAttribute("lang",e.value),"rendition"==e.name&&n.setAttribute("class",e.value.replace(/#/g,""));if(n.setAttribute("data-origname",t.localName),t.hasAttributes()&&n.setAttribute("data-origatts",t.getAttributeNames().join(" ")),0==t.childNodes.length&&n.setAttribute("data-empty",""),"head"==t.localName){let i=e.evaluate("count(ancestor::*[tei:head])",t,function(e){if("tei"==e)return"http://www.tei-c.org/ns/1.0"},XPathResult.NUMBER_TYPE,null);n.setAttribute("data-level",i.numberValue)}if("tagsDecl"==t.localName){let e=document.createElement("style");for(let i of Array.from(t.childNodes))if(i.nodeType==Node.ELEMENT_NODE&&"rendition"==i.localName&&"css"==i.getAttribute("scheme")){let t="";i.hasAttribute("selector")?(t+=i.getAttribute("selector").replace(/([^#, >]+\w*)/g,"tei-$1").replace(/#tei-/g,"#")+"{\n",t+=i.textContent):(t+="."+i.getAttribute("xml:id")+"{\n",t+=i.textContent),t+="\n}\n",e.appendChild(document.createTextNode(t))}e.childNodes.length>0&&(n.appendChild(e),this.hasStyle=!0)}"prefixDef"==t.localName&&(this.prefixDefs.push(t.getAttribute("ident")),this.prefixDefs[t.getAttribute("ident")]={matchPattern:t.getAttribute("matchPattern"),replacementPattern:t.getAttribute("replacementPattern")});for(let e of Array.from(t.childNodes))e.nodeType==Node.ELEMENT_NODE?n.appendChild(s(e)):n.appendChild(e.cloneNode());return i&&i(n,t),n};if(this.dom=s(e.documentElement),this.utilities.dom=this.dom,this.applyBehaviors(),this.done=!0,!t)return window&&window.dispatchEvent(n),this.dom;t(this.dom,this),window&&window.dispatchEvent(n)}unsetNamespace(e){this.namespaces.delete(e)}setBaseUrl(e){this.base=e}append(e,t){let i=this;if(!t)return function(){if(!this.hasAttribute("data-processed")){let t=e.call(i.utilities,this);t&&!i.childExists(this.firstElementChild,t.nodeName)&&i.appendBasic(this,t)}};{let s=e.call(i.utilities,t);s&&!i.childExists(t.firstElementChild,s.nodeName)&&i.appendBasic(t,s)}}appendBasic(e,i){t(e,!0),e.appendChild(i)}bName(e){return e.tagName.substring(0,e.tagName.indexOf("-")).toLowerCase()+":"+e.getAttribute("data-origname")}childExists(e,t){return!(!e||e.nodeName!=t)||e&&e.nextElementSibling&&this.childExists(e.nextElementSibling,t)}decorator(e){if(Array.isArray(e)&&!Array.isArray(e[0]))return this.applyDecorator(e);let t=this;return function(i){for(let s of e)if(i.matches(s[0])||"_"===s[0])return Array.isArray(s[1])?t.decorator(s[1]).call(this,i):s[1].call(this,i)}}applyDecorator(e){let t=this;return function(i){let s=[];for(let n=0;n<e.length;n++)s.push(t.template(e[n],i));return t.insert(i,s)}}getFallback(e,t){if(e[t])return e[t]instanceof Function?e[t]:decorator(e[t])}getHandler(e,t){if(e[t])return e[t]instanceof Function?this.append(e[t]):this.append(this.decorator(e[t]))}insert(e,t){let i=document.createElement("span");for(let t of Array.from(e.childNodes))t.nodeType!==Node.ELEMENT_NODE||t.hasAttribute("data-processed")||this.processElement(t);if(t[0].match("<[^>]+>")&&t[1]&&t[1].match("<[^>]+>")){i.innerHTML=t[0]+(t[1]?t[1]:"");for(let t of Array.from(e.childNodes))i.firstElementChild.appendChild(t.cloneNode(!0))}else{i.innerHTML=t[0],i.setAttribute("data-before",t[0].replace(/<[^>]+>/g,"").length);for(let t of Array.from(e.childNodes))i.appendChild(t.cloneNode(!0));t.length>1&&(i.innerHTML+=t[1],i.setAttribute("data-after",t[1].replace(/<[^>]+>/g,"").length))}return i}processElement(e){if(e.hasAttribute("data-origname")&&!e.hasAttribute("data-processed")){let t=this.getFallback(this.bName(e));t&&(this.append(t,e),e.setAttribute("data-processed",""))}for(let t of Array.from(e.childNodes))t.nodeType===Node.ELEMENT_NODE&&this.processElement(t)}tagName(e){return e.includes(":"),e.replace(/:/,"-").toLowerCase()}template(e,t){let i=e;if(e.search(/\$(\w*)(@([a-zA-Z:]+))/)){let s,n=/\$(\w*)@([a-zA-Z:]+)/g;for(;s=n.exec(e);)i=t.hasAttribute(s[2])?s[1]&&this.utilities[s[1]]?i.replace(s[0],this.utilities[s[1]](t.getAttribute(s[2]))):i.replace(s[0],t.getAttribute(s[2])):i.replace(s[0],"")}return i}define(e){for(let t of e)try{let e=this.getHandler(this.behaviors,t);window.customElements.define(this.tagName(t),class extends HTMLElement{constructor(){super(),this.matches(":defined")||(e&&e.call(this),this.setAttribute("data-processed",""))}connectedCallback(){this.hasAttribute("data-processed")||(e&&e.call(this),this.setAttribute("data-processed",""))}})}catch(e){this.debug&&(console.log(tagName(t)+" couldn't be registered or is already registered."),console.log(e))}}fallback(e){for(let t of e){let e=getFallback(this.behaviors,t);if(e)for(let i of Array.from((this.dom&&!this.done?this.dom:document).getElementsByTagName(tagName(t))))i.hasAttribute("data-processed")||append(e,i)}}static savePosition(){window.sessionStorage.setItem(window.location+"-scroll",window.scrollY)}static restorePosition(){if(window.location.hash)setTimeout(function(){let e=document.querySelector(window.decodeURI(window.location.hash));e&&e.scrollIntoView()},100);else{let e;(e=window.sessionStorage.getItem(window.location+"-scroll"))&&setTimeout(function(){window.scrollTo(0,e)},100)}}}try{if(window){window.CETEI=s,window.addEventListener("beforeunload",s.savePosition);var n=new Event("ceteiceanload");window.addEventListener("ceteiceanload",s.restorePosition)}}catch(e){console.log(e)}return s}();
